<UserControl x:Class="RemoteDesktop.Views.Components.ServerBrowser"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:cv="clr-namespace:RemoteDesktop.Infrastructure.Convertres"
             xmlns:st="clr-namespace:RemoteDesktop.Infrastructure.TemplateSelectors"
             xmlns:vm="clr-namespace:RemoteDesktop.ViewModels"
             xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop"
             xmlns:controls="clr-namespace:RemoteDesktop.Views.Controls">

   <UserControl.Resources>
      <cv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityInverseConverter" Inverse="True" />

      <HierarchicalDataTemplate x:Key="GroupTemplate" DataType="{x:Type vm:TreeItemViewModel}" ItemsSource="{Binding Children}">
         <TextBlock Text="{Binding Name}" Foreground="{DynamicResource TextForeground}" />
      </HierarchicalDataTemplate>

      <HierarchicalDataTemplate x:Key="ServerTemplate" DataType="{x:Type vm:TreeItemViewModel}">
         <StackPanel Orientation="Horizontal">
            <TextBlock Text="&#xE7F4;" FontFamily="{StaticResource FontIcon}" VerticalAlignment="Center" Foreground="{DynamicResource TextForeground}" />
            <TextBlock Text="{Binding Name}" Margin="5,0,0,0" Foreground="{DynamicResource TextForeground}" />
         </StackPanel>
      </HierarchicalDataTemplate>

      <st:TreeItemTemplateSelector x:Key="ItemTemplateSelector" GroupTemplate="{StaticResource GroupTemplate}" ServerTemplate="{StaticResource ServerTemplate}" />
   </UserControl.Resources>

   <Border Style="{StaticResource ContentPanel}">
      <TabControl Style="{StaticResource TabControlUniformStyle}">
         <TabItem Header="All">
            <Grid>
               <Grid.RowDefinitions>
                  <RowDefinition Height="Auto" />
                  <RowDefinition />
               </Grid.RowDefinitions>

               <controls:SearchBar Margin="4" SearchText="{Binding SearchText, Mode=TwoWay}" />

               <TreeView Name="TreeView" Grid.Row="1" Margin="3.5,0,3.5,4" ItemsSource="{Binding ServersGroups}"
                         Background="Transparent" BorderThickness="0"
                         ItemTemplateSelector="{StaticResource ItemTemplateSelector}"
                         SelectedItemChanged="TreeView_SelectedItemChanged" dd:DragDrop.IsDragSource="True" dd:DragDrop.IsDropTarget="True">

                  <TreeView.ItemContainerStyle>
                     <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                        <Setter Property="Visibility" Value="{Binding IsVisible, Mode=TwoWay, Converter={StaticResource BooleanToVisibilityInverseConverter}}" />
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                     </Style>
                  </TreeView.ItemContainerStyle>
               </TreeView>
            </Grid>
         </TabItem>

         <TabItem Header="Favorites" IsEnabled="False" />
      </TabControl>
   </Border>
</UserControl>