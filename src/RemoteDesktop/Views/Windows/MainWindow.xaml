<Window x:Class="RemoteDesktop.Views.Windows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:cv="clr-namespace:RemoteDesktop.Infrastructure.ValueConverters"
        xmlns:st="clr-namespace:RemoteDesktop.Infrastructure.TemplateSelectors"
        xmlns:vm="clr-namespace:RemoteDesktop.ViewModels"
        xmlns:ct="clr-namespace:RemoteDesktop.Views.UserControls"
        xmlns:ad="https://github.com/Dirkster99/AvalonDock"
        Height="650"
        Width="1200"
        Title="Remote Desktop"

        WindowStartupLocation="CenterScreen"
        Style="{StaticResource WindowStyle}">

   <Window.Resources>
      <cv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityInverseConverter" Inverse="True" />

      <HierarchicalDataTemplate x:Key="GroupTemplate" DataType="{x:Type vm:TreeItemViewModel}" ItemsSource="{Binding Children}">
         <TextBlock Text="{Binding Name}" Foreground="{DynamicResource TextForeground}" />
      </HierarchicalDataTemplate>

      <HierarchicalDataTemplate x:Key="ServerTemplate" DataType="{x:Type vm:TreeItemViewModel}">
         <StackPanel Orientation="Horizontal">
            <TextBlock Text="&#xE7F4;" FontFamily="{StaticResource FontIcon}" VerticalAlignment="Center" Foreground="{DynamicResource TextForeground}" />
            <TextBlock Text="{Binding Name}" Margin="5,0,0,0" Foreground="{DynamicResource TextForeground}" />
         </StackPanel>
      </HierarchicalDataTemplate>

      <st:TreeItemTemplateSelector x:Key="ItemTemplateSelector" GroupTemplate="{StaticResource GroupTemplate}" ServerTemplate="{StaticResource ServerTemplate}" />
   </Window.Resources>

   <Border Style="{StaticResource BorderWindowStyle}">
      <Grid>
         <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
         </Grid.RowDefinitions>

         <ct:WindowBar Background="{DynamicResource ContentBackground}" BorderThickness="0,0,0,1" BorderBrush="{DynamicResource BorderBrush}">
            <ct:WindowBar.LeftContent>
               <Menu Background="Transparent">
                  <MenuItem Header="Connect" Icon="&#xE8AF;" Command="{Binding ConnectCommand}" />
                  <Separator Style="{StaticResource SeparatorStyle}" />

                  <MenuItem Header="Manage" Icon="&#xED25;">
                     <MenuItem Header="Manage Servers" Icon="&#xE703;">
                        <MenuItem Header="Add New Server" Icon="&#xE836;" />
                        <MenuItem Header="Edit Server" Icon="&#xE70F;" />
                        <MenuItem Header="Delete Server" Icon="&#xE74D;" />
                     </MenuItem>

                     <MenuItem Header="Manage Groups" Icon="&#xED25;">
                        <MenuItem Header="Add New Group" Icon="&#xE8F4;" />
                        <MenuItem Header="Edit Group" Icon="&#xE70F;" />
                        <MenuItem Header="Delete Group" Icon="&#xE74D;" />
                     </MenuItem>
                  </MenuItem>
               </Menu>
            </ct:WindowBar.LeftContent>

            <ct:WindowBar.RightContent>
               <Button Content="&#xE713;" FontSize="12" Style="{StaticResource WindowButtonStyle}" />
            </ct:WindowBar.RightContent>
         </ct:WindowBar>

         <Border Padding="5" Grid.Row="1">
            <Grid>
               <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="250" MinWidth="250" MaxWidth="500" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition />
               </Grid.ColumnDefinitions>

               <GridSplitter Grid.Column="1" Style="{StaticResource VerticalSplitterStyle}" />

               <Border Grid.Column="0" Style="{StaticResource ContentPanel}">
                  <TabControl Style="{StaticResource TabControlUniformStyle}">
                     <TabItem Header="All">
                        <Grid>
                           <Grid.RowDefinitions>
                              <RowDefinition Height="Auto" />
                              <RowDefinition />
                           </Grid.RowDefinitions>

                           <ct:SearchBox Margin="4" SearchText="{Binding SearchText, Mode=TwoWay}" />

                           <TreeView Name="TreeView" Grid.Row="1" Margin="3.5,0,3.5,4" ItemsSource="{Binding ServersGroups}"
                                     Background="Transparent" BorderThickness="0"
                                     SelectedItemChanged="TreeView_SelectedItemChanged"
                                     ItemTemplateSelector="{StaticResource ItemTemplateSelector}">

                              <TreeView.ItemContainerStyle>
                                 <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                                    <Setter Property="Visibility" Value="{Binding IsVisible, Mode=TwoWay, Converter={StaticResource BooleanToVisibilityInverseConverter}}" />
                                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                                 </Style>
                              </TreeView.ItemContainerStyle>
                           </TreeView>

                           <ct:EmptyBox Grid.Row="1" Visibility="{Binding ElementName=TreeView, Path=HasItems, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        </Grid>
                     </TabItem>

                     <TabItem Header="Favorites" IsEnabled="False" />
                  </TabControl>
               </Border>

               <Border Grid.Column="2" Style="{StaticResource ContentPanel}" Padding="0">
                  <ad:DockingManager Grid.Column="2" Margin="3" DocumentsSource="{Binding ConnectedServers}" ActiveContent="{Binding ActiveConnect}" IsVirtualizingDocument="True" DocumentClosed="Server_Diconnect">
                     <ad:DockingManager.Resources>
                        <DataTemplate DataType="{x:Type vm:ConnectedServerViewModel}">
                           <ct:RdpClient />
                        </DataTemplate>
                     </ad:DockingManager.Resources>

                     <ad:LayoutRoot>
                        <ad:LayoutPanel Orientation="Horizontal">
                           <ad:LayoutDocumentPane />
                        </ad:LayoutPanel>
                     </ad:LayoutRoot>
                  </ad:DockingManager>
               </Border>
            </Grid>
         </Border>
      </Grid>
   </Border>
</Window>